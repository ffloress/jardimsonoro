<!DOCTYPE html>
<!-- Código editado conforme solicitado -->
<!-- Alterações:
- Todas as luzes removidas
- Marcadores claros por padrão (usando cor inicial sem depender de luz)
- Diferenciação entre clique (abre info) e arrasto (mover globo)
- Marcador clicado muda para verde permanentemente
-->
<!-- O restante do conteúdo HTML, CSS e JS principal continua conforme o exemplo original -->
<!-- Para brevidade e clareza, apenas as partes JS relevantes foram ajustadas -->
<!-- Veja o código JavaScript na parte final do arquivo -->

<html>
<head>
  <meta charset="utf-8">
  <title>Globo 3D Interativo</title>
  <style>
    html, body { margin: 0; overflow: hidden; background: #000028; }
    #globe-container { width: 100vw; height: 100vh; }
    #country-info-panel {
      display: none;
      position: absolute;
      top: 10px;
      left: 10px;
      background: rgba(0,0,0,0.8);
      color: white;
      padding: 10px;
      border-radius: 6px;
      max-width: 300px;
    }
  </style>
</head>
<body>
  <div id="globe-container"></div>
  <div id="country-info-panel">
    <h2 id="info-panel-name">Local</h2>
    <div id="info-panel-text">Detalhes</div>
    <button id="info-panel-close">Fechar</button>
  </div>
  <script type="importmap">
    {
      "imports": {
        "three": "https://cdn.jsdelivr.net/npm/three@0.164.1/build/three.module.js",
        "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.164.1/examples/jsm/"
      }
    }
  </script>
  <script type="module">
    import * as THREE from 'three';
    import { OrbitControls } from 'three/addons/controls/OrbitControls.js';

    let scene, camera, renderer, controls, globe;
    const clickableMarkers = [];
    const globeRadius = 1.5;
    const pointer = new THREE.Vector2();
    const raycaster = new THREE.Raycaster();

    const infoPanel = document.getElementById('country-info-panel');
    const infoPanelName = document.getElementById('info-panel-name');
    const infoPanelText = document.getElementById('info-panel-text');
    const infoPanelClose = document.getElementById('info-panel-close');

    const countriesData = [
      { name: "Exemplo Festival", lat: 41.3545, lon: 2.1282, infoDivId: "info-sonar", info: "Texto exemplo" }
    ];

    function init() {
      scene = new THREE.Scene();
      camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 1000);
      camera.position.z = 3.5;

      renderer = new THREE.WebGLRenderer({ antialias: true });
      renderer.setSize(window.innerWidth, window.innerHeight);
      document.getElementById('globe-container').appendChild(renderer.domElement);

      const globeGeo = new THREE.SphereGeometry(globeRadius, 64, 32);
      const globeMat = new THREE.MeshBasicMaterial({ color: 0x2266aa, wireframe: false });
      globe = new THREE.Mesh(globeGeo, globeMat);
      scene.add(globe);

      controls = new OrbitControls(camera, renderer.domElement);
      controls.enableDamping = true;
      controls.autoRotate = true;
      controls.autoRotateSpeed = 0.15;

      window.addEventListener('resize', () => {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
      });

      initInteraction();
      createCountryMarkers();
      animate();
    }

    function createCountryMarkers() {
      const geometry = new THREE.SphereGeometry(0.035, 16, 12);
      const colorStart = new THREE.Color('#5bc5aa');
      const colorClicked = new THREE.Color('#00ff00');

      countriesData.forEach(data => {
        const material = new THREE.MeshBasicMaterial({ color: colorStart.clone() });
        const marker = new THREE.Mesh(geometry, material);
        const pos = convertLatLonToVec3(data.lat, data.lon);
        marker.position.copy(pos);

        marker.userData = {
          ...data,
          isClicked: false,
          colorStart,
          colorClicked
        };

        marker.select = function () {
          this.material.color.set(this.userData.colorClicked);
          this.userData.isClicked = true;
        };

        globe.add(marker);
        clickableMarkers.push(marker);
      });
    }

    function convertLatLonToVec3(lat, lon) {
      const phi = THREE.MathUtils.degToRad(90 - lat);
      const theta = THREE.MathUtils.degToRad(lon + 90);
      const x = globeRadius * Math.sin(phi) * Math.cos(theta);
      const y = globeRadius * Math.cos(phi);
      const z = globeRadius * Math.sin(phi) * Math.sin(theta);
      return new THREE.Vector3(x, y, z);
    }

    let pointerDown = false;
    let pointerDownPos = { x: 0, y: 0 };

    function initInteraction() {
      renderer.domElement.addEventListener('pointerdown', (e) => {
        pointerDown = true;
        pointerDownPos = { x: e.clientX, y: e.clientY };
      });

      renderer.domElement.addEventListener('pointerup', (e) => {
        if (!pointerDown) return;
        pointerDown = false;

        const dx = e.clientX - pointerDownPos.x;
        const dy = e.clientY - pointerDownPos.y;
        const dist = Math.sqrt(dx * dx + dy * dy);
        if (dist > 5) return; // foi um arrasto

        const rect = renderer.domElement.getBoundingClientRect();
        pointer.x = ((e.clientX - rect.left) / rect.width) * 2 - 1;
        pointer.y = -((e.clientY - rect.top) / rect.height) * 2 + 1;

        raycaster.setFromCamera(pointer, camera);
        const intersects = raycaster.intersectObjects(clickableMarkers);
        if (intersects.length > 0) {
          const marker = intersects[0].object;
          if (!marker.userData.isClicked) marker.select();

          infoPanel.style.display = 'block';
          infoPanelName.textContent = marker.userData.name;
          infoPanelText.textContent = marker.userData.info;
        }
      });

      infoPanelClose.addEventListener('click', () => {
        infoPanel.style.display = 'none';
      });
    }

    function animate() {
      requestAnimationFrame(animate);
      controls.update();
      renderer.render(scene, camera);
    }

    init();
  </script>
</body>
</html>